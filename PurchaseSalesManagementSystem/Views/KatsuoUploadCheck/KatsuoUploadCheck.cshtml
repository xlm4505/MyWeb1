@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Katsuo Upload and Check - Fujikin</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="~/lib/xlsx/xlsx.full.min.js"></script>
</head>
<body class="p-4">

    <!-- ナビバー -->
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/Home/Menu">← Back to Menu</a>
            <span class="text-white">Katsuo Upload and Check</span>
        </div>
    </nav>

    <!-- タブ切り替え -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">Katsuo Upload</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="checklist-tab" data-bs-toggle="tab" data-bs-target="#checklist" type="button" role="tab">Open PO Check List</button>
        </li>
    </ul>

    <!-- タブ内容 -->
    <div class="tab-content mt-3">
        <!-- タブ1：ファイルアップロード -->
        <div class="tab-pane fade show active" id="upload" role="tabpanel">
            <div class="card p-3">
                <input type="file" id="fileInput" class="form-control mb-3" multiple>

                <!-- 選択ファイル一覧（枠付き） -->
                <div id="fileList" class="border rounded p-2 mb-3" style="min-height:60px;">
                    <strong>File Selected:</strong>
                    <ul id="fileListItems" class="mb-0"></ul>
                </div>

                <button class="btn btn-primary" onclick="runUpload()">RUN</button>
                <div id="uploadMessage" class="mt-3 text-success fw-bold"></div>
            </div>
        </div>

        <!-- タブ2：チェックリスト生成 -->
        <div class="tab-pane fade" id="checklist" role="tabpanel">
            <div class="card p-3">
                <label for="selectAction" class="me-2">Product Type:</label>
                <select id="selectAction" class="form-select w-auto mb-3">
                    <option value="Valves">Valves</option>
                    <option value="MassFlow">Mass Flow</option>
                </select>
                <button class="btn btn-primary" onclick="runChecklist()">RUN</button>
                <div id="checklistArea" class="mt-3"></div>
                <div id="messageArea" class="mt-3 text-primary fw-bold"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ファイル選択時に一覧を表示
        document.getElementById("fileInput").addEventListener("change", function () {
            const fileListItems = document.getElementById("fileListItems");
            fileListItems.innerHTML = "";
            if (this.files.length === 0) {
                const li = document.createElement("li");
                li.textContent = "No File Selected";
                fileListItems.appendChild(li);
            } else {
                for (const file of this.files) {
                    const li = document.createElement("li");
                    li.textContent = file.name;
                    fileListItems.appendChild(li);
                }
            }
        });

        // タブ切り替え時に画面クリア
        document.addEventListener("DOMContentLoaded", () => {
            const tabEl = document.querySelectorAll('button[data-bs-toggle="tab"]');
            tabEl.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function (event) {
                    const targetId = event.target.getAttribute("data-bs-target");

                    // Katsuo Upload タブに切り替えたとき
                    if (targetId === "#upload") {
                        document.getElementById("fileInput").value = "";
                        document.getElementById("fileListItems").innerHTML = "";
                        document.getElementById("uploadMessage").textContent = "";
                    }

                    // Open PO Check List タブに切り替えたとき
                    if (targetId === "#checklist") {
                        document.getElementById("selectAction").selectedIndex = 0;
                        document.getElementById("checklistArea").innerHTML = "";
                        document.getElementById("messageArea").textContent = "";
                    }
                });
            });
        });

        // ファイルアップロード処理（ダミー）
        function runUpload() {
            const fileInput = document.getElementById("fileInput");
            const msg = document.getElementById("uploadMessage");
            if (!fileInput.files.length) {
                msg.textContent = "No file selected.";
            } else {
                msg.textContent = "Upload complete! (" + fileInput.files.length + " files)";
            }
        }

        // チェックリスト生成処理（ダミー）
        function runChecklist() {
            const action = document.getElementById("selectAction").value;
            const area = document.getElementById("checklistArea");
            const messageArea = document.getElementById("messageArea");

            messageArea.textContent = "Checklist generating...";

            setTimeout(() => {
                messageArea.textContent = "CheckList OK";


                // Excel生成
                const data = [
                    ["Step1", "OK"],
                    ["Step2", "OK"],
                    ["Step3", "OK"],
                    ["Step4", "OK"]
                ];
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Checklist");
                const filename = "Katsuo_Check_List_" + new Date().toISOString().slice(0, 10) + ".xlsx";
                XLSX.writeFile(wb, filename);
            }, 1500);
        }
    </script>
</body>
</html>
