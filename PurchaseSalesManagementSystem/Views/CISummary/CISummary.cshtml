@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CI Summary - Fujikin</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="~/lib/xlsx/xlsx.full.min.js"></script>
</head>
<body class="p-4">
    <!-- ナビバー -->
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/Home/Menu">← Back to Menu</a>
            <span class="text-white">CI Summary</span>
        </div>
    </nav>

    <!-- アップロードフォーム -->
    <div class="card p-3">
        <input type="file" id="fileInput" class="form-control mb-3" multiple>

        <!-- 選択ファイル一覧（枠付き） -->
        <div id="fileList" class="border rounded p-2 mb-3" style="min-height:60px;">
            <strong>File Selected:</strong>
            <ul id="fileListItems" class="mb-0"></ul>
        </div>

        <!-- アップロードボタン -->
        <button class="btn btn-primary" onclick="uploadFile('Katsuo Upload and Check')">Convert</button>
    </div>

    <!-- メッセージ表示 -->
    <div id="messageArea" class="mt-3 text-primary fw-bold"></div>

    <!-- チェックリスト表示 -->
    <div id="checklist" class="mt-4" style="display:none;">
        <h5>Console log</h5>
        <ul class="list-group">
            <li class="list-group-item">✔ Connect to Sage100 OK</li>
            <li class="list-group-item">✔ Upload OK</li>
            <li class="list-group-item">✔ Complete OK</li>
        </ul>
    </div>

    <script>
        // ファイル選択時に一覧を表示
        document.getElementById("fileInput").addEventListener("change", function () {
            const fileListItems = document.getElementById("fileListItems");
            fileListItems.innerHTML = "";
            if (this.files.length === 0) {
                const li = document.createElement("li");
                li.textContent = "No File Selected";
                fileListItems.appendChild(li);
            } else {
                for (const file of this.files) {
                    const li = document.createElement("li");
                    li.textContent = file.name;
                    fileListItems.appendChild(li);
                }
            }
        });

        function uploadFile(buttonName) {
            const fileInput = document.getElementById("fileInput");
            const messageArea = document.getElementById("messageArea");

            if (!fileInput.files.length) {
                alert("Select entry File");
                return;
            }

            // メッセージ表示：アップロード開始
            messageArea.textContent = "Upload Start...";

            // ダミー処理：少し待ってから完了メッセージとチェックリスト表示
            setTimeout(() => {
                messageArea.textContent = "Upload OK！CheckList OK";
                document.getElementById("checklist").style.display = "block";

                // Excel生成（チェックリスト＋ボタン名）
                const data = [
                    ["Check List", buttonName],
                    ["File Count", fileInput.files.length],
                    ["Step1", "OK"],
                    ["Step2", "OK"],
                    ["Step3", "OK"],
                    ["Step4", "OK"]
                ];

                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Checklist");

                const filename = "CI Summary_" +
                    new Date().toISOString().slice(0, 10) + ".xlsx";
                XLSX.writeFile(wb, filename);
            }, 1500);
        }
    </script>
</body>
</html>
