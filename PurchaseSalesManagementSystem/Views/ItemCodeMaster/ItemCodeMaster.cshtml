@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ItemMaster - Fujikin</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="~/lib/xlsx/xlsx.full.min.js"></script>
    <style>
        .tab-content {
            max-height: 500px;
            overflow-y: auto;
        }

        table th, table td {
            white-space: nowrap;
        }
    </style>
</head>
<body class="p-4">

    <!-- ナビバー -->
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/Home/Menu">← Back to Menu</a>
            <span class="text-white">Item Master</span>
        </div>
    </nav>

    <!-- 検索フォーム -->
    <div class="d-flex align-items-center gap-3 mb-3">
        <label for="search">Item Code:</label>
        <input type="text" id="search" class="form-control w-auto">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="chkInactive">
            <label class="form-check-label" for="chkInactive">Exclude inactive items</label>
        </div>
        <button class="btn btn-primary" onclick="searchItems()">Search</button>
    </div>

    <!-- タブ -->
    <ul class="nav nav-tabs" id="tabMenu">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#main">Main Warehouses</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#excluded">Excluded Warehouses</a></li>
    </ul>

    <div class="tab-content mt-3">
        <div class="tab-pane fade show active" id="main">
            <table class="table table-bordered table-sm" id="gridMain"><thead><tr></tr></thead><tbody></tbody></table>
        </div>
        <div class="tab-pane fade" id="excluded">
            <table class="table table-bordered table-sm" id="gridExcluded"><thead><tr></tr></thead><tbody></tbody></table>
        </div>
    </div>

    <!-- 操作ボタン -->
    <div class="mt-4">
        <button id="btnExport" class="btn btn-success" onclick="exportTable('gridMain')" disabled>
            Export to Excel
        </button>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const columns = [
            "ItemCode", "ItemDesc", "Category", "ProductType", "Inactive", "Weight(lb)", "Whse", "PrimaryVendor",
            "StdSalesPrice", "StdUnitCost", "LastCost", "AvgCost", "VenCost(USD)", "VenCost(JPY)",
            "OnHand", "OpenSO", "Available", "OpenPO", "InShip",
            "OnHand_Ex", "OpenSO_Ex", "Available_Ex", "OpenPO_Ex", "InShip_Ex",
            "List COP", "Standard", "Discount", "Class 4", "Class 5", "Contract", "Class 6",
            "LastSold", "LastReceipt", "ExtendedDescription", "DateCreated", "UserCreated", "DateUpdated", "UserUpdated"
        ];

        // ヘッダー生成
        function createHeader(tableId) {
            const thead = document.querySelector(`#${tableId} thead tr`);
            thead.innerHTML = "";
            columns.forEach(col => {
                const th = document.createElement("th");
                th.textContent = col;
                thead.appendChild(th);
            });
        }

        // 検索処理
        function searchItems() {
            const keyword = document.getElementById("search").value.toLowerCase();
            const excludeInactive = document.getElementById("chkInactive").checked;
            const gridMain = document.querySelector("#gridMain tbody");
            const gridExcluded = document.querySelector("#gridExcluded tbody");
            gridMain.innerHTML = "";
            gridExcluded.innerHTML = "";

            let rowCount = 0;

            for (let i = 1; i <= 1000; i++) {
                const itemCode = `A${String(i).padStart(4, '0')}`;
                const itemDesc = `Widget ${i}`;
                const inactiveFlag = (i % 2 === 0) ? "*" : "";

                if (keyword && !itemCode.toLowerCase().includes(keyword) && !itemDesc.toLowerCase().includes(keyword)) continue;
                if (excludeInactive && inactiveFlag === "*") continue;

                const row = [
                    itemCode, itemDesc, "Component", "Finished Good", inactiveFlag, "1", "001", "ACME",
                    "$10", "$6", "$5", "$5.50", "$4.80", "¥580",
                    "100", "20", "80", "10", "5",
                    "50", "10", "40", "5", "2",
                    "$12", "$10", "$9", "$8", "$7", "$6", "$5",
                    "2023-01-01", "2023-01-10", "RoHS compliant", "2022-12-01", "John Doe", "2023-01-15", "Jane Smith"
                ];

                const trMain = document.createElement("tr");
                const trEx = document.createElement("tr");
                row.forEach(cell => {
                    const td1 = document.createElement("td");
                    td1.textContent = cell;
                    trMain.appendChild(td1);

                    const td2 = document.createElement("td");
                    td2.textContent = cell;
                    trEx.appendChild(td2);
                });
                gridMain.appendChild(trMain);
                gridExcluded.appendChild(trEx);
                rowCount++;
            }

            // データがある場合のみExportボタンを有効化
            document.getElementById("btnExport").disabled = (rowCount === 0);
        }

        // Excel出力（フィルター付き）
        function exportTable(tableId) {
            const table = document.getElementById(tableId);
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(table);

            // フィルター範囲を設定
            const range = XLSX.utils.decode_range(ws['!ref']);
            ws['!autofilter'] = { ref: XLSX.utils.encode_range(range) };

            XLSX.utils.book_append_sheet(wb, ws, "ItemMaster");
            const filename = "ItemMaster_" + new Date().toISOString().slice(0, 19).replace(/[-T:]/g, "") + ".xlsx";
            XLSX.writeFile(wb, filename);
        }

        // 初期化
        createHeader("gridMain");
        createHeader("gridExcluded");
    </script>
</body>
</html>
